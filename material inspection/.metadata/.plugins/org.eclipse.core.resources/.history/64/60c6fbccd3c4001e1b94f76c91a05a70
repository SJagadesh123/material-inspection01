package com.zettamine.mi.controller;

import java.sql.Date;
import java.time.LocalDate;
import java.util.List;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import com.zettamine.mi.entities.InspectionLot;
import com.zettamine.mi.entities.Material;
import com.zettamine.mi.entities.Plant;
import com.zettamine.mi.entities.Vendor;
import com.zettamine.mi.service.MaterialService;
import com.zettamine.mi.service.PlantService;
import com.zettamine.mi.service.VendorService;

@Controller
@RequestMapping("/material-inspection/inspection")
public class InspectionController {
	
	private VendorService vendorService;
	private MaterialService materialService;
	private PlantService plantService;
	
	
	
	
	public InspectionController(VendorService vendorService, MaterialService materialService,
			PlantService plantService) {
		super();
		this.vendorService = vendorService;
		this.materialService = materialService;
		this.plantService = plantService;
	}




	@GetMapping("/new")
	public String getNewInspection(Model model)
	{
		model.addAttribute("inspection", new InspectionLot());
		List<Material> material = materialService.getAll();
		List<Vendor> vendor = vendorService.getAll();
		List<Plant> plant = plantService.getAll();
		
		model.addAttribute("material",material);
		model.addAttribute("vendor",vendor);
		model.addAttribute("plant",plant);
		return "add-inspection";
	}
	
	@PostMapping({"/add-inspection"})
	public String addInspection(InspectionLot inspection, Model model)
	{
		System.out.println(inspection);
		Date createdDate = inspection.getInspCreatedDate();
		Date startDate = inspection.getInspStartDate();
		if(createdDate.compareTo(startDate) > 0)
		{
			System.out.println("------------------");
			model.addAttribute("error", "* start date must be greater than created date");
			
			return getNewInspection(model);
		}
		
		LocalDate now = LocalDate.now();
		Date currentDate = Date.valueOf(now);
		
		if(createdDate.compareTo(currentDate) > 0 || startDate.compareTo(currentDate) > 0)
		{
			System.out.println("------------------");
			model.addAttribute("error", "* Date must be less than current date");
			
			return getNewInspection(model);
		}
		
		return "inspection";
	}

}
